<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>GeoPlay — Login</title>
  <style>
    :root{ --bg:#0b0f1a; --card:rgba(255,255,255,.06); --line:rgba(255,255,255,.12); --text:#eaf0ff; --muted:rgba(234,240,255,.72); --accent:#7aa7ff; }
    [data-theme="light"]{ --bg:#f6f7fb; --card:#fff; --line:#e4e7f0; --text:#0b0f1a; --muted:#4b5563; --accent:#2563eb; }
    [data-theme="purple"]{ --bg:#0a0416; --card:rgba(255,255,255,.07); --line:rgba(255,255,255,.12); --text:#f2eaff; --muted:rgba(242,234,255,.72); --accent:#b37aff; }
    [data-theme="green"]{ --bg:#06140f; --card:rgba(255,255,255,.07); --line:rgba(255,255,255,.12); --text:#eafff3; --muted:rgba(234,255,243,.72); --accent:#35d07f; }
    body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);min-height:100vh;display:grid;place-items:center}
    a{color:var(--accent);text-decoration:none}
    .box{width:min(560px,92vw);border:1px solid var(--line);background:var(--card);border-radius:18px;padding:18px}
    input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:transparent;color:var(--text);margin-top:10px}
    button{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:transparent;color:var(--text);cursor:pointer}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    .muted{color:var(--muted);font-size:13px}
    .msg{min-height:18px;margin-top:10px}
    .oauth{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    header{position:fixed;top:0;left:0;right:0;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--line);background:color-mix(in srgb,var(--bg) 80%, transparent);backdrop-filter:blur(10px)}
    .btn{padding:9px 12px;border-radius:12px;border:1px solid var(--line);background:var(--card);color:var(--text)}
    select{border:1px solid var(--line);background:var(--card);color:var(--text);padding:9px 12px;border-radius:12px}
  </style>
</head>
<body>
<header>
  <a class="btn" href="/">Home</a>
  <div style="display:flex;gap:10px;align-items:center">
    <select id="theme">
      <option value="dark">Dark</option>
      <option value="light">Light</option>
      <option value="purple">Purple</option>
      <option value="green">Green</option>
    </select>
    <span class="muted" id="me">…</span>
  </div>
</header>

<div class="box">
  <h2 style="margin:0 0 6px;">Login / Register</h2>
  <div class="muted">Or use Google / GitHub / Facebook / X (requires OAuth keys in Render).</div>

  <input id="username" placeholder="Username (a-z 0-9 _)" autocomplete="username"/>
  <input id="display" placeholder="Display name (optional)" autocomplete="name"/>
  <input id="password" type="password" placeholder="Password (min 6)" autocomplete="current-password"/>

  <div class="row">
    <button id="login">Login</button>
    <button id="register">Register</button>
  </div>

  <div class="oauth">
    <button onclick="location.href='/auth/google/login'">Continue with Google</button>
    <button onclick="location.href='/auth/github/login'">Continue with GitHub</button>
    <button onclick="location.href='/auth/facebook/login'">Continue with Facebook</button>
    <button onclick="alert('X/Twitter OAuth needs keys + extra setup. Ask me when you have developer access.');">Continue with X</button>
  </div>

  <div class="msg muted" id="msg"></div>
  <div class="muted" style="margin-top:10px">
    After login, go to <a href="/upload">Upload</a>.
  </div>
</div>

<script>
  const themeSel = document.getElementById("theme");
  function setTheme(t){
    document.documentElement.dataset.theme = (t === "dark" ? "" : t);
    localStorage.setItem("theme", t);
  }
  setTheme(localStorage.getItem("theme") || "dark");
  themeSel.value = localStorage.getItem("theme") || "dark";
  themeSel.onchange = ()=> setTheme(themeSel.value);

  const me = document.getElementById("me");
  async function j(url){ const r=await fetch(url); return r.json(); }
  (async ()=> {
    const m = await j("/api/me");
    me.textContent = m.logged_in ? ("@"+m.username) : "guest";
  })();

  const u = document.getElementById("username");
  const d = document.getElementById("display");
  const p = document.getElementById("password");
  const msg = document.getElementById("msg");

  async function postForm(url, data){
    const fd = new FormData();
    Object.entries(data).forEach(([k,v])=>fd.append(k,v));
    const r = await fetch(url, {method:"POST", body: fd});
    const t = await r.text();
    let jdata; try{ jdata = JSON.parse(t);}catch{ jdata = {raw:t}; }
    if(!r.ok) throw new Error(jdata.detail || t);
    return jdata;
  }

  document.getElementById("register").onclick = async ()=>{
    msg.textContent = "Registering…";
    try{
      await postForm("/api/register", {
        username: u.value.trim(),
        password: p.value,
        display_name: d.value.trim()
      });
      msg.textContent = "Registered ✅ Now press Login.";
    }catch(e){
      msg.textContent = "Error: " + e.message;
    }
  };

  document.getElementById("login").onclick = async ()=>{
    msg.textContent = "Logging in…";
    try{
      await postForm("/api/login", {username: u.value.trim(), password: p.value});
      msg.textContent = "Success ✅ Redirecting…";
      setTimeout(()=>location.href="/", 400);
    }catch(e){
      msg.textContent = "Error: " + e.message;
    }
  };
</script>
</body>
</html>
