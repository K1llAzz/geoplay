<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>GeoPlay — Login</title>
  <style>
    body{margin:0;font-family:system-ui;background:#0b0f1a;color:#eaf0ff;display:grid;place-items:center;min-height:100vh}
    .box{width:min(520px,92vw);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);border-radius:18px;padding:18px}
    input{width:100%;padding:12px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.08);color:#eaf0ff;margin-top:10px}
    button{margin-top:12px;width:100%;padding:12px;border-radius:12px;border:1px solid rgba(122,167,255,.28);background:rgba(122,167,255,.18);color:#eaf0ff;cursor:pointer}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    a{color:#7aa7ff;text-decoration:none}
    .msg{opacity:.8;margin-top:10px;font-size:13px;min-height:18px}
  </style>
</head>
<body>
  <div class="box">
    <h2 style="margin:0 0 8px;">Login / Register</h2>
    <div style="opacity:.75;margin-bottom:12px;">Go back: <a href="/">Home</a></div>

    <input id="u" placeholder="Username"/>
    <input id="p" type="password" placeholder="Password"/>

    <div class="row">
      <button id="login">Login</button>
      <button id="register">Register</button>
    </div>

    <div class="msg" id="msg"></div>
  </div>

<script>
  const u = document.getElementById("u");
  const p = document.getElementById("p");
  const msg = document.getElementById("msg");

  async function postForm(url, data){
    const fd = new FormData();
    Object.entries(data).forEach(([k,v])=>fd.append(k,v));
    const r = await fetch(url, {method:"POST", body: fd});
    const t = await r.text();
    let j; try{ j = JSON.parse(t);}catch{ j = {raw:t}; }
    if(!r.ok) throw new Error(j.detail || j.error || t);
    return j;
  }

  document.getElementById("login").onclick = async ()=>{
    msg.textContent = "Logging in…";
    try{
      await postForm("/api/login", {username:u.value, password:p.value});
      msg.textContent = "Success ✅";
      setTimeout(()=>location.href="/", 400);
    }catch(e){
      msg.textContent = "Error: " + e.message;
    }
  };

  document.getElementById("register").onclick = async ()=>{
    msg.textContent = "Registering…";
    try{
      await postForm("/api/register", {username:u.value, password:p.value});
      msg.textContent = "Registered ✅ Now login.";
    }catch(e){
      msg.textContent = "Error: " + e.message;
    }
  };
</script>
</body>
</html>
